---
description: 리팩터링 계획서 작성 워크플로우 (대규모 리팩터링 시작 전 필수)
---

# 리팩터링 계획서 작성

> **⚠️ 필수**: 코드 작성 전 반드시 이 워크플로우를 완료해야 합니다.

## 1. Clarifying Questions (대형 작업 필수)

> **적용 조건**: 예상 작업 시간 4시간+ 또는 여러 모듈에 걸친 변경

### 질문 영역
| 영역 | 질문 목적 |
|------|----------|
| **Problem/Goal** | 이 리팩터링이 해결하는 문제는? |
| **Scope** | 영향받는 모듈 범위는? |
| **Risk** | 가장 위험한 변경 지점은? |
| **Rollback** | 롤백 전략은? |

### 질문 형식 (A/B/C 선택지 제공)
```
1. 리팩터링 우선순위는?
   A. 긴급 (기능 구현 블로킹)
   B. 높음 (기술 부채 해소)
   C. 표준 (코드 품질 개선)

2. 영향 범위는?
   A. 단일 모듈
   B. 여러 모듈 (인터페이스 유지)
   C. 여러 모듈 (인터페이스 변경)
```

> ⚠️ **사용자 답변 수집 후 계획서 작성 진행**

---

## 2. 사전 컨텍스트 확인

// turbo
다음 파일들을 읽고 현재 상황을 파악합니다:
- `@PROJECT_DNA.md` — 프로젝트 정책 및 코드 품질 기준
- `docs/context/REFACTORING.md` — 리팩터링 가이드 및 우선순위
- `docs/Plan/refactor/` 내 기존 계획서 — 중복 작업 방지

## 3. 바퀴 재발명 금지 (No Reinventing the Wheel)

> **원칙**: 직접 구현 전 **반드시** 기존 솔루션 검색. 더 빠른 길이 있으면 그 길로.

### 필수 검색 프로세스
```
1. **기존 코드베이스 검색** (우선)
   - grep_search로 유사 기능 검색
   - docs/_architecture/ 문서 확인
   - 재사용 가능한 클래스/함수 식별

2. **외부 솔루션 검색**
   - PyPI / GitHub / Stack Overflow 검색 (최소 3곳)

3. **결과 기록**
   - 발견한 라이브러리/패턴 목록
   - 채택/미채택 사유
   - 없으면 "검색 완료, 적합한 솔루션 없음" 명시
```

### 계획서 필수 섹션 추가
```markdown
## X. 기존 솔루션 검색 결과
| 솔루션 | 출처 | 채택 여부 | 사유 |
|--------|------|----------|------|
| (예시) ib_insync TRAIL | 공식문서 | ✅ 채택 | 네이티브 기능으로 클라이언트 복잡도 제거 |
```

> ⚠️ **검색 없이 직접 구현 = 계획서 반려**

---

## 4. 영향 분석 (Impact Analysis)

리팩터링 대상에 대해 다음을 분석합니다:
- **변경 대상 파일 목록**: 어떤 파일들이 수정되는지
- **영향받는 모듈**: 변경으로 인해 영향받는 다른 모듈들
- **순환 의존성 체크**: `pydeps --show-cycles` 실행
- **위험도 평가**: 낮음/중간/높음

## 5. 계획서 작성 (PRD 구조 + 2레벨 Task)

경로: `docs/Plan/{yy-mm-dd}/{hh-mm}_{phase}-{step}_{subtitle}.md`

예시: `docs/Plan/26-01-16/14-30_02-001_di_container_cleanup.md`

### 계획서 필수 포함 사항

```markdown
# [리팩터링 대상] 리팩터링 계획서

> **작성일**: YYYY-MM-DD HH:MM
> **우선순위**: {순위} | **예상 소요**: {X}h | **위험도**: 낮음/중간/높음

## 1. 목표 (PRD 구조)

### 1.1 배경 (Problem)
- [해결하려는 기술 부채/문제]

### 1.2 목표 (Goal)
- [리팩터링으로 달성하려는 것]

### 1.3 Non-Goals (범위 제외)
- ❌ [이번 작업에 포함 안 함]

## 2. 영향 분석
- 변경 파일 목록
- 영향받는 모듈
- 순환 의존성 현황

## 3. Tasks (2레벨 분해)

> **규칙**: 완료 시 `- [ ]` → `- [x]`로 마킹

- [ ] 1.0 [Parent Task 제목]
  - [ ] 1.1 [Sub-task 설명]
  - [ ] 1.2 [Sub-task 설명]
- [ ] 2.0 [Parent Task 제목]
  - [ ] 2.1 [Sub-task 설명]

## 4. 검증 계획
- [ ] lint-imports 통과
- [ ] pydeps 순환 의존성 없음
- [ ] pytest 통과
- [ ] 수동 테스트 항목

## 5. 롤백 계획
- 문제 발생 시 롤백 방법
```

## 6. 사용자 승인 대기

계획서 작성 완료 후 **반드시** 사용자 승인을 받습니다.
승인 전까지 코드 수정을 시작하지 않습니다.

---

**다음 단계**: 승인 후 `/refactoring-execution` 워크플로우를 실행합니다.
