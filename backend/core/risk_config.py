# ============================================================================
# Risk Configuration - ë¦¬ìŠ¤í¬ ê´€ë¦¬ ì„¤ì •
# ============================================================================
# ðŸ“Œ ì´ íŒŒì¼ì˜ ì—­í• :
#   - ë¦¬ìŠ¤í¬ ê´€ë¦¬ íŒŒë¼ë¯¸í„° ì •ì˜
#   - í¬ì§€ì…˜ ì‚¬ì´ì§•, ì†ì‹¤ í•œë„, ê±°ëž˜ ì œí•œ ì„¤ì •
#
# ðŸ“– ì‚¬ìš© ì˜ˆì‹œ:
#   >>> from backend.core.risk_config import RiskConfig
#   >>> config = RiskConfig(max_position_pct=5.0, daily_loss_limit_pct=-2.0)
# ============================================================================

"""
Risk Configuration Module

ë¦¬ìŠ¤í¬ ê´€ë¦¬ë¥¼ ìœ„í•œ ì„¤ì • ë°ì´í„°í´ëž˜ìŠ¤ìž…ë‹ˆë‹¤.
"""

from dataclasses import dataclass, field
from typing import Optional


@dataclass
class RiskConfig:
    """
    ë¦¬ìŠ¤í¬ ê´€ë¦¬ ì„¤ì •
    
    Attributes:
        max_position_pct: í¬ì§€ì…˜ë‹¹ ìµœëŒ€ ë¹„ìœ¨ (ê³„ì¢Œ ëŒ€ë¹„ %)
        max_positions: ìµœëŒ€ ë™ì‹œ í¬ì§€ì…˜ ìˆ˜
        daily_loss_limit_pct: ì¼ì¼ ì†ì‹¤ í•œë„ (%)
        weekly_loss_limit_pct: ì£¼ê°„ ì†ì‹¤ í•œë„ (%)
        max_daily_trades: ì¼ì¼ ìµœëŒ€ ê±°ëž˜ íšŸìˆ˜
        per_trade_stop_pct: ê±°ëž˜ë‹¹ Stop Loss (%)
        use_kelly: Kelly Criterion ì‚¬ìš© ì—¬ë¶€
        kelly_fraction: Kelly ë¹„ìœ¨ ì¡°ì • (0.25 = 1/4 Kelly)
    
    Example:
        >>> config = RiskConfig()
        >>> print(f"ì¼ì¼ ì†ì‹¤ í•œë„: {config.daily_loss_limit_pct}%")
        ì¼ì¼ ì†ì‹¤ í•œë„: -3.0%
    """
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Position Sizing (masterplan 11.1)
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    max_position_pct: float = 10.0
    """í¬ì§€ì…˜ë‹¹ ìµœëŒ€ ë¹„ìœ¨ (ê³„ì¢Œì˜ 10%)"""
    
    max_positions: int = 3
    """ìµœëŒ€ ë™ì‹œ í¬ì§€ì…˜ ìˆ˜"""
    
    max_daily_trades: int = 50
    """ì¼ì¼ ìµœëŒ€ ê±°ëž˜ íšŸìˆ˜"""
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Loss Limits (masterplan 11.2)
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    per_trade_stop_pct: float = -5.0
    """ê±°ëž˜ë‹¹ Stop Loss (-5%)"""
    
    daily_loss_limit_pct: float = -3.0
    """ì¼ì¼ ì†ì‹¤ í•œë„ (-3%) - ë„ë‹¬ ì‹œ ìžë™ ì •ì§€"""
    
    weekly_loss_limit_pct: float = -10.0
    """ì£¼ê°„ ì†ì‹¤ í•œë„ (-10%) - ë„ë‹¬ ì‹œ ìˆ˜ë™ ë¦¬ë·°"""
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Kelly Criterion
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    use_kelly: bool = False
    """Kelly Criterion ì‚¬ìš© ì—¬ë¶€"""
    
    kelly_fraction: float = 0.25
    """Kelly ë¹„ìœ¨ ì¡°ì • (1/4 Kelly ê¶Œìž¥)"""
    
    kelly_min_trades: int = 20
    """Kelly ê³„ì‚°ì„ ìœ„í•œ ìµœì†Œ ê±°ëž˜ ìˆ˜"""
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Kill Switch
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    auto_kill_on_daily_limit: bool = True
    """ì¼ì¼ í•œë„ ë„ë‹¬ ì‹œ ìžë™ Kill Switch ë°œë™"""
    
    def to_dict(self) -> dict:
        """ë”•ì…”ë„ˆë¦¬ë¡œ ë³€í™˜"""
        return {
            "max_position_pct": self.max_position_pct,
            "max_positions": self.max_positions,
            "max_daily_trades": self.max_daily_trades,
            "per_trade_stop_pct": self.per_trade_stop_pct,
            "daily_loss_limit_pct": self.daily_loss_limit_pct,
            "weekly_loss_limit_pct": self.weekly_loss_limit_pct,
            "use_kelly": self.use_kelly,
            "kelly_fraction": self.kelly_fraction,
        }
