# ============================================================================
# Tick Data Model - ì‹¤ì‹œê°„ í‹± ë°ì´í„° êµ¬ì¡°ì²´
# ============================================================================
# ğŸ“Œ ì´ íŒŒì¼ì˜ ì—­í• :
#   - ì‹¤ì‹œê°„ í‹± ë°ì´í„° êµ¬ì¡°ì²´ ì •ì˜
#   - í‹± ë²„í¼ì— ì €ì¥ë˜ì–´ Ignition Score ê³„ì‚°ì— ì‚¬ìš©
#
# ğŸ“– ì‚¬ìš© ì˜ˆì‹œ:
#   >>> from backend.models import TickData
#   >>> tick = TickData(
#   ...     price=10.50, volume=1000,
#   ...     event_time=datetime.fromtimestamp(1736330000),
#   ...     receive_time=datetime.now()
#   ... )
#
# ğŸ“– ë¦¬íŒ©í„°ë§ [07-001]:
#   - seismograph/models.py â†’ backend/models/tick.py ì´ë™
#
# ğŸ“– ë¦¬íŒ©í„°ë§ [08-001] Phase 2:
#   - timestamp â†’ event_time + receive_time ë¶„ë¦¬
#   - í•˜ìœ„ í˜¸í™˜ì„±: timestamp í”„ë¡œí¼í‹° ìœ ì§€
# ============================================================================

"""
Tick Data Model

ì‹¤ì‹œê°„ í‹± ë°ì´í„° êµ¬ì¡°ì²´ì…ë‹ˆë‹¤.
"""

from dataclasses import dataclass, field
from datetime import datetime


@dataclass
class TickData:
    """
    ì‹¤ì‹œê°„ í‹± ë°ì´í„° êµ¬ì¡°ì²´

    í‹± ë²„í¼ì— ì €ì¥ë˜ì–´ Ignition Score ê³„ì‚°ì— ì‚¬ìš©ë©ë‹ˆë‹¤.

    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ì‰¬ìš´ ì„¤ëª… (ELI5):
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ì£¼ì‹ì´ ê±°ë˜ë  ë•Œë§ˆë‹¤ í•˜ë‚˜ì˜ í‹±ì´ ë°œìƒí•©ë‹ˆë‹¤.
    ì´ êµ¬ì¡°ì²´ëŠ” "ì–¸ì œ, ì–¼ë§ˆì—, ëª‡ ì£¼, ë§¤ìˆ˜/ë§¤ë„" ì •ë³´ë¥¼ ë‹´ìŠµë‹ˆë‹¤.

    [08-001] ì‹œê°„ ë¶„ë¦¬:
      - event_time: ê±°ë˜ì†Œì—ì„œ ì²´ê²°ëœ ì‹¤ì œ ì‹œê°„ (ì´ë²¤íŠ¸ ì‹œê°„)
      - receive_time: ìš°ë¦¬ ì„œë²„ê°€ ë°ì´í„°ë¥¼ ë°›ì€ ì‹œê°„ (ìˆ˜ì‹  ì‹œê°„)

    ì´ ë‘ ì‹œê°„ì˜ ì°¨ì´ê°€ ê³§ "ë°ì´í„° ì§€ì—° ì‹œê°„"ì…ë‹ˆë‹¤.
    ì „ëµ ê³„ì‚°ì—ëŠ” event_timeì„ ì‚¬ìš©í•´ì•¼ ì •í™•í•©ë‹ˆë‹¤!

    Attributes:
        price: ì²´ê²° ê°€ê²© (ì˜ˆ: 10.50)
        volume: ì²´ê²° ìˆ˜ëŸ‰ (ì˜ˆ: 1000ì£¼)
        event_time: ê±°ë˜ì†Œ ì²´ê²° ì‹œê°„ (ì†ŒìŠ¤ íƒ€ì„ìŠ¤íƒ¬í”„)
        receive_time: ì„œë²„ ìˆ˜ì‹  ì‹œê°„ (ë¡œì»¬ íƒ€ì„ìŠ¤íƒ¬í”„)
        side: ì²´ê²° ë°©í–¥ ("B" = ë§¤ìˆ˜, "S" = ë§¤ë„)

    Example:
        >>> from datetime import datetime
        >>> tick = TickData(
        ...     price=10.50,
        ...     volume=1000,
        ...     event_time=datetime.fromtimestamp(1736330000),
        ...     receive_time=datetime.now(),
        ...     side="B"
        ... )
        >>> tick.timestamp  # í•˜ìœ„ í˜¸í™˜ì„±
        datetime(...)
    """

    price: float
    volume: int
    # [08-001] event_time: ê±°ë˜ì†Œ ì²´ê²° ì‹œê°„ (í•„ìˆ˜)
    event_time: datetime
    # [08-001] receive_time: ì„œë²„ ìˆ˜ì‹  ì‹œê°„ (ê¸°ë³¸ê°’: í˜„ì¬ ì‹œê°„)
    receive_time: datetime = field(default_factory=datetime.now)
    side: str = "B"  # "B" (buy) or "S" (sell)

    @property
    def timestamp(self) -> datetime:
        """
        [08-001] í•˜ìœ„ í˜¸í™˜ì„± í”„ë¡œí¼í‹°

        ê¸°ì¡´ ì½”ë“œê°€ tick.timestampë¡œ ì ‘ê·¼í•˜ëŠ” ê²½ìš°ë¥¼ ìœ„í•´ ìœ ì§€.
        event_timeì„ ë°˜í™˜í•©ë‹ˆë‹¤ (ì „ëµ ê³„ì‚° ê¸°ì¤€).

        Returns:
            datetime: event_time (ê±°ë˜ì†Œ ì²´ê²° ì‹œê°„)
        """
        return self.event_time

    @property
    def latency_ms(self) -> int:
        """
        [08-001] ë°ì´í„° ì§€ì—° ì‹œê°„ (ë°€ë¦¬ì´ˆ)

        ê±°ë˜ì†Œ ì²´ê²° ì‹œê°„ê³¼ ì„œë²„ ìˆ˜ì‹  ì‹œê°„ì˜ ì°¨ì´ì…ë‹ˆë‹¤.

        Returns:
            int: ì§€ì—° ì‹œê°„ (ë°€ë¦¬ì´ˆ). ìŒìˆ˜ë©´ ì‹œê°„ ë™ê¸°í™” ë¬¸ì œ.
        """
        delta = self.receive_time - self.event_time
        return int(delta.total_seconds() * 1000)


__all__ = ["TickData"]
