# [09-007] 蹂쇰ⅷ 李⑦듃 ?덈룄??遺꾨━ + Dollar Volume 蹂??諛?Zoom/Scroll ?깊겕 援ы쁽 怨꾪쉷??
> **?묒꽦??*: 2026-01-10 | **?덉긽**: 2h
> **?곹깭**: ?뱥 怨꾪쉷 寃???湲?> **?좏뻾 ?묒뾽**: 09-001 (finplot 留덉씠洹몃젅?댁뀡 ?꾨즺)

---

## 1. 紐⑺몴

1. **?덈룄??遺꾨━**: ?꾩옱 **蹂쇰ⅷ 李⑦듃媛 罹붾뱾?ㅽ떛 李⑦듃? ?숈씪 ?덈룄?곗뿉 ?ㅻ쾭?덉씠**?섏뼱 ?덈뒗 援ъ“瑜?**遺꾨━???덈룄??*濡?蹂寃?2. **Zoom/Scroll ?숆린??*: ??李⑦듃 媛꾩쓽 **Zoom/Scroll???먮룞?쇰줈 ?숆린??*?섎룄濡??섏젙
3. **Dollar Volume (dolvol) 蹂??*: ?⑥닚 Volume ???**Dollar Volume (= Close 횞 Volume)** ?쒖떆

> [!NOTE]
> ?꾩옱 援ы쁽: `self.ax_volume = self.ax.overlay()` (?ㅻ쾭?덉씠 諛⑹떇, ?⑥닚 Volume)
> 紐⑺몴 援ы쁽: `fplt.create_plot(rows=2)` 諛⑹떇?쇰줈 蹂꾨룄 ?됱뿉 **Dollar Volume** 李⑦듃 諛곗튂

---

## 2. ?꾩옱 ?곹깭 遺꾩꽍

### 2.1 ?꾩옱 援ъ“ (臾몄젣??

```
?뚢????????????????????????????????????????????????? Candlestick + Volume (媛숈? ax ?꾩뿉 overlay) ???? ?뚢??????????????????????????????????????????먥봻
?? ???빉截?罹붾뱾?ㅽ떛 (ax)                         ?귘봻
?? ???뱤 蹂쇰ⅷ 諛?(ax_volume = ax.overlay())   ?귘봻 ??臾몄젣: 寃뱀묠
?? ?붴??????????????????????????????????????????섃봻
?붴???????????????????????????????????????????????```

**臾몄젣??*:
1. **?쒓컖??媛꾩꽠**: 蹂쇰ⅷ 諛붽? 罹붾뱾?ㅽ떛怨?寃뱀퀜 媛?낆꽦 ???2. **Zoom/Scroll 鍮꾨룞湲?*: 蹂쇰ⅷ 李⑦듃??ViewBox媛 蹂꾨룄濡?愿由щ릺??罹붾뱾怨??깊겕 ????3. **Y異??ㅼ???異⑸룎**: 媛寃?Y異뺢낵 蹂쇰ⅷ Y異뺤씠 ?ㅻⅨ 踰붿쐞?꾩뿉??媛숈? 怨듦컙 ?ъ슜

### 2.2 紐⑺몴 援ъ“ (媛쒖꽑)

```
?뚢????????????????????????????????????????????????? Candlestick Window (ax)                    ???? ?뚢??????????????????????????????????????????먥봻
?? ???빉截?罹붾뱾?ㅽ떛                              ?귘봻
?? ?붴??????????????????????????????????????????섃봻
?쒋????????????????????????????????????????????????? Dollar Volume Window (ax_volume) - X異??숆린?????? ?뚢??????????????????????????????????????????먥봻
?? ???뮫 Dollar Volume 諛?(= Close 횞 Volume)  ?귘봻
?? ?붴??????????????????????????????????????????섃봻
?붴???????????????????????????????????????????????          ??X異?Zoom/Scroll ?먮룞 ?깊겕
```

---

## 3. 湲곗〈 ?붾（??寃??寃곌낵

| ?붾（??| 異쒖쿂 | 梨꾪깮 ?щ? | ?ъ쑀 |
|--------|------|----------|------|
| `fplt.create_plot(rows=N)` | finplot 怨듭떇 | ??梨꾪깮 | ?ㅼ쨷 ??吏?? X異??먮룞 ?깊겕 |
| `ax.overlay()` | ?꾩옱 援ы쁽 | ???먭린 | ?ㅻ쾭?덉씠 諛⑹떇?쇰줈 遺꾨━ 遺덇? |
| 蹂꾨룄 QWidget 遺꾨━ | - | ??誘몄콈??| ?섎룞 ?깊겕 援ы쁽 蹂듭옟??利앷? |

> **寃곕줎**: finplot 怨듭떇 `create_plot(rows=2)` 諛⑹떇 ?ъ슜?쇰줈 X異??먮룞 ?숆린???뺣낫

---

## 4. ?덉씠??泥댄겕

- [x] ?덉씠??洹쒖튃 ?꾨컲 ?놁쓬 (Frontend GUI ?대? ?섏젙)
- [x] ?쒗솚 ?섏〈???놁쓬
- [x] DI Container ?깅줉 ?꾩슂: **?꾨땲??*

---

## 5. 蹂寃??뚯씪

| ?뚯씪 | ?좏삎 | ?덉긽 ?쇱씤 | 蹂寃??댁슜 |
|------|-----|----------|-----------|
| [finplot_chart.py](file:///d:/Codes/Sigma9-0.1/frontend/gui/chart/finplot_chart.py) | MODIFY | +40 / -15 | `_setup_ui()` 蹂寃?+ `set_volume_data()` ??Dollar Volume 怨꾩궛 異붽? |

---

## 6. ?ㅽ뻾 ?④퀎

### Step 1: `_setup_ui()` ?섏젙 - 李⑦듃 ?앹꽦 諛⑹떇 蹂寃?
**?꾩옱 肄붾뱶** (L152-L162):
```python
# 硫붿씤 李⑦듃 (罹붾뱾?ㅽ떛)
self.ax = fplt.create_plot(init_zoom_periods=100)

# 蹂쇰ⅷ 李⑦듃 (?ㅻ쾭?덉씠)
self.ax_volume = self.ax.overlay()

# finplot ?붽뎄?ы빆: ?꾩젽??axs ?띿꽦 ?ㅼ젙
self.axs = [self.ax, self.ax_volume]

# ax.vb.win (ViewBox???덈룄?????덉씠?꾩썐??異붽?
layout.addWidget(self.ax.vb.win, stretch=1)
```

**蹂寃???肄붾뱶**:
```python
# ?ㅼ쨷 ??李⑦듃 ?앹꽦 (罹붾뱾?ㅽ떛 + 蹂쇰ⅷ)
# rows=2 ?ъ슜??finplot???먮룞?쇰줈 X異??깊겕 泥섎━
self.ax, self.ax_volume = fplt.create_plot(
    title='',
    rows=2,
    init_zoom_periods=100
)

# finplot ?붽뎄?ы빆: ?꾩젽??axs ?띿꽦 ?ㅼ젙
self.axs = [self.ax, self.ax_volume]

# 蹂쇰ⅷ 李⑦듃 ?믪씠 鍮꾩쑉 議곗젙 (罹붾뱾 3 : 蹂쇰ⅷ 1)
self.ax_volume.setFixedHeight(80)  # ?쎌? ?⑥쐞 ?먮뒗 鍮꾩쑉 議곗젙

# ax.vb.win (ViewBox???덈룄?????덉씠?꾩썐??異붽?
layout.addWidget(self.ax.vb.win, stretch=1)
```

### Step 2: ViewBox ?쒗븳 ?댁젣 濡쒖쭅 ?낅뜲?댄듃

**?꾩옱 肄붾뱶** (`_disable_viewport_limits()` L496-L511):
```python
# Volume 李⑦듃???숈씪?섍쾶 ?곸슜
if hasattr(self, "ax_volume") and self.ax_volume:
    self.ax_volume.vb.disableAutoRange()
    self.ax_volume.vb.setLimits(xMin=None, xMax=None, yMin=None, yMax=None)
```

> [!TIP]
> `rows=2` 諛⑹떇?먯꽌???숈씪 濡쒖쭅 ?좎? 媛?? finplot???먮룞?쇰줈 X異뺤쓣 留곹겕?섎?濡?> 硫붿씤 ax留??쒗븳 ?댁젣?대룄 蹂쇰ⅷ 李⑦듃???④퍡 ?ㅽ겕濡ㅻ릺吏留? 紐낆떆?곸쑝濡??????댁젣 沅뚯옣.

### Step 3: `clear()` 硫붿꽌???명솚???뺤씤

**?꾩옱 肄붾뱶** (L477-L485):
```python
def clear(self) -> None:
    """李⑦듃 珥덇린??""
    self.ax.reset()
    self.ax_volume.reset()
    # ...
```

> rows=2 諛⑹떇?먯꽌??`ax.reset()` ?숈씪?섍쾶 ?숈옉. 蹂寃?遺덊븘??

### Step 4: `set_volume_data()` ??Dollar Volume 怨꾩궛 異붽?

**?꾩옱 肄붾뱶** (L274-L309):
```python
def set_volume_data(self, volume_data: List[Dict]) -> None:
    """
    Volume 諛?李⑦듃 ?ㅼ젙

    Args:
        volume_data: [{"time": timestamp, "volume": int, "is_up": bool}, ...]
    """
    # ... ?⑥닚 volume ?쒖떆
    df = df.rename(columns={"volume": "Volume"})
```

**蹂寃???肄붾뱶**:
```python
def set_volume_data(self, volume_data: List[Dict]) -> None:
    """
    Dollar Volume 諛?李⑦듃 ?ㅼ젙

    Args:
        volume_data: [{"time": timestamp, "volume": int, "close": float, "is_up": bool}, ...]
        
    ELI5:
        Dollar Volume = 嫄곕옒??횞 醫낃?
        ?ㅼ젣 嫄곕옒??湲덉븸??蹂댁뿬以섏꽌 ?⑥닚 嫄곕옒?됰낫???섎? ?덉쓬
    """
    if not volume_data:
        return

    self._volume_data = volume_data

    # DataFrame 蹂??    df = pd.DataFrame(volume_data)
    df["time"] = pd.to_datetime(df["time"], unit="s")
    df = df.set_index("time")
    
    # Dollar Volume 怨꾩궛 (close 횞 volume)
    # close媛 ?놁쑝硫?湲곗〈 volume ?ъ슜 (?섏쐞?명솚)
    if "close" in df.columns:
        df["Volume"] = df["volume"] * df["close"]
    else:
        df["Volume"] = df["volume"]

    # finplot volume_ocv??Open, Close, Volume 3媛?而щ읆 ?꾩슂
    if "is_up" in df.columns:
        df["Open"] = 0
        df["Close"] = df["is_up"].apply(lambda x: 1 if x else -1)
    else:
        df["Open"] = 0
        df["Close"] = 1

    # 湲곗〈 蹂쇰ⅷ ?뚮’ ?쒓굅
    self.ax_volume.reset()

    # Dollar Volume ?뚮’
    self._volume_plot = fplt.volume_ocv(
        df[["Open", "Close", "Volume"]], ax=self.ax_volume
    )

    fplt.refresh()
```

> [!IMPORTANT]
> **?몄텧遺 ?섏젙 ?꾩슂**: `set_volume_data()` ?몄텧 ??`close` 媛믪쓣 ?④퍡 ?꾨떖?댁빞 ??
> ?꾩옱 罹붾뱾 ?곗씠?곗? 蹂쇰ⅷ ?곗씠?곌? 蹂꾨룄濡??꾨떖?섎?濡? 罹붾뱾 ?곗씠?곗뿉??close 媛믪쓣 異붿텧?섏뿬 蹂묓빀 ?꾩슂.

---

## 7. 寃利?怨꾪쉷

### 7.1 ?섎룞 ?뚯뒪??(?꾩닔)

1. **Frontend ?ㅽ뻾**:
   ```bash
   cd D:\Codes\Sigma9-0.1
   python -m frontend.main
   ```

2. **?쒓컖???뺤씤 ??ぉ**:
   | ??ぉ | ?덉긽 寃곌낵 |
   |------|----------|
   | 罹붾뱾?ㅽ떛 李⑦듃 | ?곷떒 ?곸뿭???⑤룆 ?쒖떆 |
   | Dollar Volume 李⑦듃 | ?섎떒 蹂꾨룄 ?곸뿭???쒖떆 (罹붾뱾怨?遺꾨━) |
   | 李⑦듃 媛?媛꾧꺽 | ?곸젅???щ갚?쇰줈 ?쒓컖??遺꾨━ |
   | Dollar Volume 媛?| ?⑥닚 Volume???꾨땶 Close 횞 Volume 媛?諛섏쁺 |

3. **Zoom/Scroll ?깊겕 ?뚯뒪??*:
   | 議곗옉 | ?덉긽 寃곌낵 |
   |------|----------|
   | 罹붾뱾?ㅽ떛 ?곸뿭?먯꽌 留덉슦????Zoom | 蹂쇰ⅷ 李⑦듃???숈씪?섍쾶 Zoom |
   | 罹붾뱾?ㅽ떛 ?곸뿭?먯꽌 ?쒕옒洹?Scroll | 蹂쇰ⅷ 李⑦듃???숈씪?섍쾶 Scroll |
   | 蹂쇰ⅷ ?곸뿭?먯꽌 留덉슦????Zoom | 罹붾뱾?ㅽ떛 李⑦듃???숈씪?섍쾶 Zoom |
   | 醫뚯륫 ?앷퉴吏 ?ㅽ겕濡?| ??李⑦듃媛 ?숈씪???쒓컙 踰붿쐞 ?쒖떆 |

4. **??꾪봽?덉엫 蹂寃??뚯뒪??*:
   - 1m, 5m, 1h, 1D 媛곴컖 ?좏깮 ??李⑦듃 ?곗씠???뺤긽 ?쒖떆 ?뺤씤
   - ??꾪봽?덉엫 蹂寃?????李⑦듃 紐⑤몢 媛깆떊 ?뺤씤

### 7.2 ?먮룞???뚯뒪??
| ?뚯뒪??| 紐낅졊??| 湲곕? 寃곌낵 |
|--------|--------|----------|
| lint-imports | `lint-imports` | ?덉씠???꾨컲 ?놁쓬 |
| ruff check | `ruff check frontend/gui/chart/finplot_chart.py` | All checks passed |
| ruff format | `ruff format --check frontend/gui/chart/finplot_chart.py` | Already formatted |

---

## 8. ?ъ쟾 泥댄겕由ъ뒪??
- [x] ?덉씠??洹쒖튃 ?꾨컲 ?녿뒗媛?
- [x] ?좉퇋 ?쒕퉬????Container ?깅줉 怨꾪쉷 ?덈뒗媛? ??遺덊븘??- [x] ?쒗솚 ?섏〈???꾪뿕 ???명꽣?섏씠??異붿텧 怨꾪쉷 ?덈뒗媛? ???대떦 ?놁쓬
- [x] 湲곗〈 1000以? ?뚯씪 ?섏젙 ??遺꾪븷 ?좏뻾 ?꾩슂? ???꾨땲??(finplot_chart.py 801以?

---

## 9. ?꾪궎?띿쿂 ?議?
- [x] ?좉퇋 紐⑤뱢??`archt.md` ?덉씠??洹쒖튃 以??(Frontend GUI ?대?)
- [x] 蹂寃쎌씠 湲곗〈 ?명꽣?섏씠???명솚???좎? (`set_volume_data()` ?숈씪)
- [x] Tech Stack 蹂寃??놁쓬

---

## 10. 愿??臾몄꽌

- [09-001_finplot_chart_migration.md](file:///d:/Codes/Sigma9-0.1/docs/Plan/refactor/09-001_finplot_chart_migration.md) - finplot 留덉씠洹몃젅?댁뀡 怨꾪쉷??- [09-002_finplot_chart_enhancements.md](file:///d:/Codes/Sigma9-0.1/docs/Plan/refactor/09-002_finplot_chart_enhancements.md) - finplot 湲곕뒫 媛쒖꽑 怨꾪쉷??- [archt.md](file:///d:/Codes/Sigma9-0.1/.agent/Ref/archt.md) - ?쒖뒪???꾪궎?띿쿂

---

## 11. ?덉긽 由ъ뒪??諛????
| 由ъ뒪??| ?곹뼢??| ???諛⑹븞 |
|--------|--------|----------|
| `rows=2` 諛⑹떇?먯꽌 ?꾨쿋???⑦꽩 蹂寃??꾩슂 | 以?| finplot embed.py ?덉젣 李몄“?섏뿬 `ax.vb.win` ???`fplt.win` ?ъ슜 寃??|
| 蹂쇰ⅷ 李⑦듃 ?믪씠 ?섎뱶肄붾뵫 ?댁뒋 | ??| ?뚮쭏 ?ㅼ젙?쇰줈 遺꾨━ (異뷀썑 媛쒖꽑) |
| Y異??ㅼ????낅┰???뺤씤 ?꾩슂 | ??| `rows=2` 諛⑹떇? Y異??낅┰ 湲곕낯 吏??|
