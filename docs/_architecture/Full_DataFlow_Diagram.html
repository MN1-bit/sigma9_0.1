<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sigma9 Data Flow Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        h2 {
            color: #00d4ff;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #7b2cbf;
        }

        .diagram-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            overflow-x: auto;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mermaid {
            display: flex;
            justify-content: center;
        }

        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            padding: 10px 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            z-index: 100;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        nav a {
            color: #00d4ff;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            background: rgba(0, 212, 255, 0.1);
            transition: all 0.3s;
            font-size: 0.9em;
        }

        nav a:hover {
            background: rgba(0, 212, 255, 0.3);
        }

        .content {
            margin-top: 80px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        .legend {
            background: rgba(123, 44, 191, 0.2);
            border-radius: 8px;
            padding: 15px 20px;
            margin-top: 20px;
        }

        .legend table {
            width: 100%;
        }

        .legend td {
            padding: 5px 10px;
        }
    </style>
</head>

<body>
    <nav>
        <a href="#arch">ì „ì²´ ì•„í‚¤í…ì²˜</a>
        <a href="#pipeline">ë°ì´í„° íŒŒì´í”„ë¼ì¸</a>
        <a href="#trading">ì‹¤ì‹œê°„ íŠ¸ë ˆì´ë”©</a>
        <a href="#comm">Frontendâ†”Backend</a>
        <a href="#scoring">ì „ëµ ì ìˆ˜</a>
        <a href="#research">ë¦¬ì„œì¹˜ íŒŒì´í”„ë¼ì¸</a>
        <a href="#di">DI ì»¨í…Œì´ë„ˆ</a>
        <a href="#gui">GUI êµ¬ì¡°</a>
    </nav>

    <div class="content">
        <h1>ğŸ”· Sigma9 Data Flow Diagrams</h1>

        <section id="arch">
            <h2>1. ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜</h2>
            <div class="diagram-container">
                <div class="mermaid">
                    flowchart TB
                    subgraph External["ğŸŒ External Services"]
                    IBKR["IB Gateway/TWS"]
                    MASSIVE_API["Massive.com REST API"]
                    MASSIVE_WS["Massive.com WebSocket"]
                    LLM_API["LLM Providers"]
                    end

                    subgraph Backend["âš™ï¸ Backend Server"]
                    SERVER["server.py"]
                    CONTAINER["container.py"]

                    subgraph Core["ğŸ“¦ Core Engine"]
                    SCANNER["Scanner"]
                    RT_SCANNER["RealtimeScanner"]
                    IGNITION["IgnitionMonitor"]
                    end

                    subgraph Strategy["ğŸ¯ Strategy"]
                    SEISMO["SeismographStrategy"]
                    end

                    subgraph Trading["ğŸ’° Trading"]
                    ORDER_MGR["OrderManager"]
                    RISK_MGR["RiskManager"]
                    end

                    subgraph Data["ğŸ’¾ Data Layer"]
                    DATA_REPO["DataRepository"]
                    PARQUET["ParquetManager"]
                    end

                    subgraph Realtime["ğŸ“¡ Realtime"]
                    WS_MGR["ConnectionManager"]
                    TICK_BROAD["TickBroadcaster"]
                    end
                    end

                    subgraph Frontend["ğŸ–¥ï¸ Frontend GUI"]
                    DASHBOARD["Dashboard"]
                    PANELS["Panels"]
                    SERVICES["Services"]
                    end

                    MASSIVE_API --> Data
                    MASSIVE_WS --> Realtime
                    IBKR --> Trading

                    Core --> Strategy
                    Strategy --> Trading
                    Realtime --> DASHBOARD
                </div>
            </div>
        </section>

        <section id="pipeline">
            <h2>2. ë°ì´í„° íŒŒì´í”„ë¼ì¸</h2>
            <div class="diagram-container">
                <div class="mermaid">
                    flowchart LR
                    subgraph Sources["ğŸ“¥ Data Sources"]
                    API["Massive.com REST"]
                    WS["Massive.com WS"]
                    end

                    subgraph Ingestion["â¬‡ï¸ Ingestion"]
                    MC["MassiveClient"]
                    MWS["MassiveWSClient"]
                    end

                    subgraph Storage["ğŸ’¾ Storage"]
                    PARQUET["Parquet Files"]
                    SQLITE["SQLite DB"]
                    end

                    subgraph Processing["âš™ï¸ Processing"]
                    DR["DataRepository"]
                    PM["ParquetManager"]
                    end

                    subgraph Consumers["ğŸ“¤ Consumers"]
                    SCANNER["Scanner"]
                    BACKTEST["BacktestEngine"]
                    STRATEGY["Strategy"]
                    CHART["ChartService"]
                    end

                    API -->|HTTP| MC
                    WS -->|WSS| MWS
                    MC --> DR
                    DR --> PM
                    PM --> PARQUET
                    DR --> SQLITE
                    DR --> Consumers
                </div>
            </div>
        </section>

        <section id="trading">
            <h2>3. ì‹¤ì‹œê°„ íŠ¸ë ˆì´ë”© íë¦„</h2>
            <div class="diagram-container">
                <div class="mermaid">
                    flowchart TB
                    subgraph Phase1["ğŸ“‹ Phase 1: Watchlist"]
                    SCHED["Scheduler 09:15 ET"]
                    SCAN["Scanner.scan()"]
                    WL["Ranked Watchlist"]
                    SCHED --> SCAN --> WL
                    end

                    subgraph Phase2["ğŸ”¥ Phase 2: Trigger"]
                    GAIN["Gainers API 1ì´ˆ"]
                    RT["RealtimeScanner"]
                    IGN["IgnitionMonitor"]
                    TRIG["Ignition 80+"]
                    GAIN --> RT --> IGN --> TRIG
                    end

                    subgraph Phase3["ğŸ’° Phase 3: Execution"]
                    SIGNAL["Entry Signal"]
                    ORDER["OrderManager"]
                    IBKR["IBKRConnector"]
                    SIGNAL --> ORDER --> IBKR
                    end

                    subgraph Phase4["ğŸ›¡ï¸ Phase 4: Exit"]
                    TRAIL["TrailingStop"]
                    EXIT["Exit Signal"]
                    DT["DoubleTap"]
                    TRAIL --> EXIT --> DT
                    end

                    WL --> Phase2
                    TRIG --> SIGNAL
                    DT -.->|ì¬ì§„ì…| SIGNAL
                </div>
            </div>
        </section>

        <section id="comm">
            <h2>4. Frontend â†” Backend í†µì‹ </h2>
            <div class="diagram-container">
                <div class="mermaid">
                    flowchart LR
                    subgraph Frontend["ğŸ–¥ï¸ Frontend"]
                    DASH["Dashboard"]
                    BC["BackendClient"]
                    REST["RestAdapter"]
                    WSA["WsAdapter"]
                    end

                    subgraph Backend["âš™ï¸ Backend"]
                    API["REST API"]
                    WSFEED["WebSocket /ws/feed"]
                    end

                    subgraph Messages["ğŸ“¨ Messages"]
                    LOG["LOG"]
                    WATCHLIST["WATCHLIST"]
                    IGNITION["IGNITION"]
                    TICK["TICK/BAR"]
                    end

                    DASH --> BC
                    BC --> REST -->|HTTP| API
                    BC --> WSA <-->|WSS| WSFEED
                        WSFEED --> Messages
                        Messages --> WSA
                </div>
            </div>
        </section>

        <section id="scoring">
            <h2>5. ì „ëµ ì ìˆ˜ ê³„ì‚° íë¦„</h2>
            <div class="diagram-container">
                <div class="mermaid">
                    flowchart TB
                    subgraph Input["ğŸ“Š Input"]
                    BARS["Daily OHLCV 60ì¼"]
                    TICK["Real-time Tick"]
                    end

                    subgraph Indicators["ğŸ“ Indicators"]
                    VWAP["VWAP"]
                    ATR["ATR"]
                    SMA["SMA"]
                    end

                    subgraph ZScore["ğŸ“ˆ Z-Score"]
                    ZENV["zenV Volume"]
                    ZENP["zenP Price"]
                    DIV["Divergence"]
                    end

                    subgraph Signals["ğŸ¯ Signals"]
                    TR["Tight Range 30%"]
                    AB["Absorption 20%"]
                    AC["Accumulation 20%"]
                    end

                    subgraph Score["ğŸ’¯ Score"]
                    V3["score_v3 Pinpoint"]
                    IGN["Ignition Score"]
                    end

                    BARS --> Indicators
                    BARS --> ZScore
                    Indicators --> Signals
                    ZScore --> DIV --> Signals
                    Signals --> V3
                    TICK --> IGN
                    V3 --> IGN
                </div>
            </div>
        </section>

        <section id="research">
            <h2>6. ë¦¬ì„œì¹˜ ìŠ¤í¬ë¦½íŠ¸ íŒŒì´í”„ë¼ì¸ (R-3/R-4)</h2>
            <div class="diagram-container">
                <div class="mermaid">
                    flowchart LR
                    A["all_daily.parquet"] --> B["analyze_daygainers"]
                    B --> C["daygainers_75plus.csv"]
                    C --> D["build_control_group"]
                    D --> E["control_groups.csv"]
                    E --> F["build_d1_features"]
                    F --> G["d1_features.parquet"]
                    E --> H["download_minutes"]
                    H --> I["1m/*.parquet"]
                    G --> J["build_m_n_features"]
                    I --> J
                    J --> K["m_n_features.parquet"]
                    G --> L["train_xgboost"]
                    K --> L
                    L --> M["ml_report.json"]
                </div>
            </div>
        </section>

        <section id="di">
            <h2>7. DI ì»¨í…Œì´ë„ˆ ì˜ì¡´ì„±</h2>
            <div class="diagram-container">
                <div class="mermaid">
                    flowchart TB
                    subgraph External["ğŸŒ External"]
                    MASSIVE["Massive.com API"]
                    IBKR_GW["IB Gateway/TWS"]
                    end

                    subgraph Container["ğŸ“¦ DI Container"]
                    subgraph DataLayer["ï¿½ Data Layer"]
                    MC["massive_client"]
                    PM["parquet_manager"]
                    DB["database"]
                    DR["data_repository"]
                    end

                    subgraph StrategyLayer["ğŸ¯ Strategy Layer"]
                    WS["watchlist_store"]
                    TI["ticker_info_service"]
                    SM["symbol_mapper"]
                    SS["scoring_strategy"]
                    end

                    subgraph CoreLayer["âš™ï¸ Core Layer"]
                    TC["trading_context"]
                    RS["realtime_scanner"]
                    IM["ignition_monitor"]
                    AL["audit_logger"]
                    end

                    subgraph Broker["ğŸ¦ Broker"]
                    IBKR["IBKRConnector"]
                    OM["order_manager"]
                    RM["risk_manager"]
                    end
                    end

                    MASSIVE -->|HTTP| MC
                    MC --> DR
                    MC --> TI
                    PM --> DR
                    DB --> DR

                    SM --> TI
                    SM --> IBKR

                    DR --> RS
                    SS --> RS
                    SS --> IM
                    RS --> IM

                    IBKR_GW <-->|ib_insync| IBKR
                        IBKR --> OM
                        IBKR --> RM
                        OM --> RM
                </div>
            </div>
        </section>

        <section id="gui">
            <h2>8. GUI ì»´í¬ë„ŒíŠ¸ ê³„ì¸µ êµ¬ì¡°</h2>
            <div class="diagram-container">
                <div class="mermaid">
                    flowchart TB
                    MAIN["main.py"] --> QAPP["QApplication"]
                    QAPP --> DASH["Sigma9Dashboard"]

                    DASH --> CTRL["ControlPanel"]
                    DASH --> THEME["ThemeManager"]

                    subgraph Panels["ğŸ“Š Panels"]
                    WLP["WatchlistPanel"]
                    CP["ChartPanel"]
                    PP["PositionPanel"]
                    OP["OraclePanel"]
                    LP["LogPanel"]
                    end

                    DASH --> Panels

                    subgraph State["ğŸ“‹ State"]
                    DS["DashboardState"]
                    end

                    DASH --> DS
                    DS -->|signals| Panels
                </div>
            </div>
        </section>

        <div class="legend">
            <h3>ğŸ“Š ë²”ë¡€ (Legend)</h3>
            <table>
                <tr>
                    <td>ğŸ“¥ ë°ì´í„° ì…ë ¥</td>
                    <td>ğŸ“¤ ë°ì´í„° ì¶œë ¥</td>
                    <td>âš™ï¸ ì²˜ë¦¬/ì—”ì§„</td>
                    <td>ğŸ’¾ ìŠ¤í† ë¦¬ì§€</td>
                </tr>
                <tr>
                    <td>ğŸ“¡ ì‹¤ì‹œê°„/í†µì‹ </td>
                    <td>ğŸ¯ ì „ëµ/ë¶„ì„</td>
                    <td>ğŸ’° íŠ¸ë ˆì´ë”©</td>
                    <td>ğŸ–¥ï¸ UI/Frontend</td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>

</html>