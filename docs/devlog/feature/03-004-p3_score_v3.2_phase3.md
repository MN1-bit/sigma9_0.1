# 03-004-P3 Score V3.2 Phase 3 Devlog

> **ì‘ì„±ì¼**: 2026-01-06  
> **ìƒíƒœ**: âœ… Phase 3 ì™„ë£Œ  
> **ì°¸ê³ **: `docs/Plan/bugfix/03-004_score_v3.2_improvement.md`

---

## ë³€ê²½ ìš”ì•½

V3.2 Phase 3: ì •ê·œí™” ì•ˆì •í™” ë° ì¤‘ë³µ í˜ë„í‹°

| ë³€ê²½ | ê¸°ì¡´ | V3.2 Phase 3 |
|------|------|--------------|
| Tight Range ì •ê·œí™” | Z-Score Sigmoid | Percentile Rank |
| ì£½ì€ ì••ì¶• | ë¯¸ì²˜ë¦¬ | RedundancyPenalty (0.7x) |

---

## ğŸ“ ì§„í–‰ ë¡œê·¸

### 2026-01-06 11:38

**ì„¤ì • ì¶”ê°€** (`score_v3_config.py`):

```python
class PercentileConfig:
    use_percentile: bool = True
    min_samples: int = 10

class RedundancyPenaltyConfig:
    enabled: bool = True
    tr_threshold: float = 0.6
    obv_threshold: float = 0.4
    penalty_multiplier: float = 0.7
```

### 2026-01-06 11:40

**Tight Range Percentile ì ìš©** (`seismograph.py:731-787`):

```python
# ê¸°ì¡´: Z-Score Sigmoid
z = (current_atr - mean_atr) / std_atr
intensity = 1 / (1 + exp(k * z))

# V3.2: Percentile ê¸°ë°˜
count_lower = sum(1 for x in atr_list if x < current_atr)
percentile = count_lower / len(atr_list)
intensity = 1.0 - percentile  # ë‚®ì„ìˆ˜ë¡ ë†’ìŒ
```

### 2026-01-06 11:41

**RedundancyPenalty ì¶”ê°€** (`seismograph.py:1106-1140`):

```python
def _calculate_redundancy_penalty(intensities):
    tr = intensities.get("tight_range", 0.0)
    obv = intensities.get("obv_divergence", 0.0)
    
    # ì••ì¶•ë§Œ ìˆê³  í¡ìˆ˜ ì—†ìœ¼ë©´ ì£½ì€ ì••ì¶•
    if tr >= 0.6 and obv <= 0.4:
        return 0.7  # 30% ê°ì 
    return 1.0
```

### 2026-01-06 11:42

**ê²€ì¦**: `python -m py_compile` âœ… í†µê³¼

---

## ğŸ”§ ìˆ˜ì • íŒŒì¼

| íŒŒì¼ | ë³€ê²½ ìœ í˜• | ìƒíƒœ |
|------|----------|------|
| `backend/strategies/score_v3_config.py` | PercentileConfig, RedundancyPenaltyConfig | âœ… |
| `backend/strategies/seismograph.py` | TR Percentile, RedundancyPenalty | âœ… |
| `docs/Plan/bugfix/03-004_score_v3.2_improvement.md` | ìƒíƒœ ì—…ë°ì´íŠ¸ | âœ… |

---

## âœ… ê²€ì¦ ê²°ê³¼

- **êµ¬ë¬¸ ê²€ì‚¬**: âœ… í†µê³¼
- **GUI ê²€ì¦**: ì ìˆ˜ ë¶„í¬ ë° ì£½ì€ ì••ì¶• í•„í„°ë§ í™•ì¸ í•„ìš”

---

## ğŸ“Œ ì™„ë£Œ í˜„í™©

| Phase | í•­ëª© | ìƒíƒœ |
|-------|------|------|
| 1 | ê°€ì‚° ë³´ë„ˆìŠ¤, í´ë¦¬í•‘, Sigmoid í˜ë„í‹° | âœ… |
| 2 | OBVâ†’Absorption, AB ë°©í–¥ì„± | âœ… |
| 3 | Percentile ì •ê·œí™”, RedundancyPenalty | âœ… |
| 4 | Activation Trigger ë¶„ë¦¬ | ê²€í†  ì¤‘ |

---

## ğŸ”§ 03-005 Absorption ë¶„í¬ ê°œì„  (2026-01-06 12:15)

### ë¬¸ì œ
- Absorption ê°•ë„ê°€ 0ì (50%) ë˜ëŠ” 100ì (20%)ì— ì§‘ì¤‘
- Hard Cutoff (`sv_norm <= 0 â†’ 0ì `) ë•Œë¬¸

### í•´ê²° (Option A: ë¶€ë“œëŸ¬ìš´ í˜ë„í‹°)

```python
if sv_norm <= 0:
    # ë§¤ë„ ìš°ì„¸: 0.0 ~ 0.5 ë²”ìœ„
    intensity = 0.5 / (1 + np.exp(-sv_norm * 2))
else:
    # ë§¤ìˆ˜ ìš°ì„¸: 0.5 ~ 1.0 ë²”ìœ„
    absorption_score = sv_norm / (avg_pr / 0.02 + 0.1)
    intensity = 0.5 + 0.5 / (1 + np.exp(-absorption_score + 0.5))
```

### ê²€ì¦
- **êµ¬ë¬¸ ê²€ì‚¬**: âœ… í†µê³¼
- **ì˜ˆìƒ íš¨ê³¼**: 0ì  ë¹„ìœ¨ 50%â†’5%, ì¤‘ê°„ê°’ ë¶„í¬ 10%â†’50%
