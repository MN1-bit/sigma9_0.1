# 연구 과제: 급등 전 스캐닝 전략 (Pre-Surge Detection)

> **문서 번호**: 001-01 부속  
> **작성일**: 2026-01-15  
> **상태**: 계획서 초안  
> **선행 조건**: 백테스트 플랫폼 MVP 완성

---

## 1. 연구 목표

**핵심 질문**: *급등 전날/직전에 해당 종목을 스캔할 수 있었는가?*

| 구분 | 설명 |
|------|------|
| 목표 | Daygainer(당일 급등주)의 **급등 이전** 공통 패턴 발굴 |
| 방법론 | Daygainer vs 대조군 비교 분석 → 차별화 지표 탐색 |
| 결과물 | 급등 확률 높은 종목 사전 필터링 스캐너 |

---

## 2. 전체 파이프라인

```
┌─────────────────────────────────────────────────────────────────────┐
│  Phase 1: 데이터 수집                                                │
│  Raw Data + 모든 보조지표 (RVOL, ATR, MA, RSI, 거래량 프로파일 등)    │
│  → 역대 Daygainer 목록 수집                                          │
└───────────────────────────────┬─────────────────────────────────────┘
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│  Phase 2: Daygainer 정보 정리                                        │
│  각 Daygainer의 D-1, D-2 시점 지표들을 DB에 구조화                    │
└───────────────────────────────┬─────────────────────────────────────┘
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│  Phase 3: 대조군 형성 (LLM + Massive MCP)                            │
│  - LLM이 섹터, 시총, 유동성 유사한 비급등 종목 매칭                    │
│  - Massive API로 과거 데이터 조회                                    │
└───────────────────────────────┬─────────────────────────────────────┘
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│  Phase 4: 특징 분석 (ML + LLM 협업)                                  │
│  4a. 탐색: LLM(가설) ↔ ML(검증) 피드백 루프                          │
│  4b. 모델링: ML 전담 (분류기 학습)                                   │
│  4c. 해석: ML(수치) → LLM(자연어 변환)                               │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 3. 핵심 원칙

### 3.1 대조군 설계의 중요성

급등주(Daygainer)만 분석 → **생존자 편향(Survivorship Bias)**  
"이 패턴이 있었다" ≠ "이 패턴이 있으면 급등한다"

**대조군 선정 기준:**
- 동일 섹터, 유사 시가총액, 유사 유동성
- 동일 기간 내 평범한 등락률 기록
- 비율: Daygainer 1 : 대조군 3~5

### 3.2 Daygainer 정의 (확정)

> [!IMPORTANT]
> **Daygainer = 당일 등락률 75% 이상**

| 기준 | 값 | 근거 |
|------|-----|------|
| **등락률** | ≥ 75% (시가 대비 종가) | 극단적 급등만 포착 |
| **거래대금** | ≥ $50만 (price × volume) | 유동성 확보 |
| **가격** | ≥ $0.1 | 초저가주 제외 |

**가중치 방식**: 연속(Continuous)
```python
weight = np.log1p(change_pct / 75)
```

**데이터 현황** (2021~2026, 5년간 1,259 거래일 기준):

| 임계값 | 레코드 수 | 연평균 | 발생 거래일 |
|--------|----------|--------|------------|
| 75%+ | **1,284건** | ~260건/년 | 772일 (61%) |
| 100%+ | **767건** | ~155건/년 | - |

**발생 빈도 분석**:
- 75%+ 발생일: 772일 / 1,259일 = **61%** (이틀 중 하루 꼴)
- 75%+ 미발생일: 487일 (39%)
- 평균 종목 수/발생일: 1.66개

**Gap 분석** (75%+ 없는 연속일):
| Gap 길이 | 횟수 | 비고 |
|----------|------|------|
| 1일 | 135회 | 가장 빈번 |
| 2-3일 | 76회 | |
| 4-7일 | 29회 | 1주 |
| 8-14일 | 4회 | 드묾 |
| **최대** | **11일** | 2주 이상 없는 경우 없음 |

**Cluster 분석** (75%+ 연속 발생일):
| Cluster 길이 | 횟수 | 비고 |
|--------------|------|------|
| 1일 | 107회 | |
| 2-3일 | 67회 | |
| 4-7일 | 45회 | 1주 연속 |
| 8일+ | **26회** | 시장 과열기 |
| **최대** | **18일** | 거의 4주 연속 |

> [!NOTE]
> **분포 특성**: 균등 분포가 아닌 **클러스터링** 패턴  
> → 시장 과열기에 집중 발생, 평상시엔 2-3일 Gap 후 재발생

### 3.3 시점 엄격성 (Point-in-Time)

> [!WARNING]
> **미래 정보 누출(Look-Ahead Bias) 절대 금지**

| 분석 시점 | 사용 가능 | 불가 |
|-----------|----------|------|
| D-1 종가 | D-1까지 OHLCV, 보조지표 | D-0 일체 |
| D-0 09:30 | D-1 종가 + 프리마켓 갭 | D-0 정규장 |

---

## 4. 접근 방법론 (확정)

> [!IMPORTANT]
> **결론: ML + LLM 협업 (단계별 역할 분담)**
> 
> "ML이냐 LLM이냐"는 잘못된 질문.  
> 각 단계마다 적합한 도구가 다름.

### 4.1 단계별 역할 분담

| 단계 | 주 담당 | 보조 | 상세 |
|------|---------|------|------|
| **4a. 탐색** | ML | LLM | LLM이 가설 제안 → ML이 정량 검증 → 피드백 |
| **4b. 모델링** | ML | LLM | ML이 분류기 학습, LLM은 피처 아이디어 제공 |
| **4c. 해석** | LLM | ML | ML이 SHAP 수치 제공 → LLM이 자연어 변환 |

### 4.2 탐색 단계 상세 (4a)

```
┌────────────────────────────────────────────────────────────┐
│  LLM ──(가설)──▶ ML ──(검증 결과)──▶ LLM ──(다음 가설)      │
│                    │                                       │
│  예시:             ▼                                       │
│  LLM: "종가 대비 저점 위치가 중요해 보임"                   │
│  → ML: low_to_close_ratio 피처 생성                        │
│  → ML: t-test p < 0.01로 유의미                            │
│  → LLM에 피드백 → 다음 가설 생성                           │
└────────────────────────────────────────────────────────────┘
```

### 4.3 모델링 단계 상세 (4b)

```python
# 입력
X = daygainer_features + control_features  # (2500, 50)
y = [1]*500 + [0]*2000  # Daygainer=1, Control=0

# 모델
model = XGBClassifier()  # 기본 선택
# 대안: LightGBM, TabNet

# 평가
precision_at_k(y_test, y_pred, k=20)
```

### 4.4 해석 단계 상세 (4c)

| 해석 유형 | 도구 |
|-----------|------|
| 피처 중요도 랭킹 | ML (SHAP) |
| 개별 예측 설명 | ML (SHAP Local) |
| 자연어 변환 | LLM |
| 도메인 컨텍스트 | LLM |

---

## 5. 데이터 요구사항

| 데이터 | 용도 | 상태 |
|--------|------|------|
| 일간 OHLCV | Daygainer 식별, 대조군 선정 | ✅ Parquet |
| 분봉 데이터 | 급등 전 패턴 분석 | ✅ Parquet |
| **Daygainer 목록** | ML 학습 대상 | ✅ CSV 추출 완료 |
| 보조지표 로그 | RVOL, ATR, 이평선 등 | 🔲 구축 필요 |
| 카탈리스트 | 뉴스, SEC 공시 | 🔲 Polygon 연동 |

**생성된 데이터 파일**:
```
scripts/
├── analyze_daygainers.py    # Daygainer 추출/분석 스크립트
├── daygainers_50plus.csv    # 50%+ (2,701건)
├── daygainers_75plus.csv    # 75%+ (1,284건) ← 주력 데이터셋
└── daygainers_100plus.csv   # 100%+ (767건)
```

---

## 6. 기술 스택

```yaml
Phase 4a (탐색):
  ml: scipy (t-test), pandas (EDA)
  llm: Claude/GPT-4o (가설 생성)

Phase 4b (모델링):
  library: scikit-learn, xgboost, shap
  validation: TimeSeriesSplit

Phase 4c (해석):
  ml: shap
  llm: Claude/GPT-4o-mini (비용 효율)
```

---

## 7. 구현 단계

| 단계 | 설명 | 선행 조건 | 상태 |
|------|------|----------|------|
| **R-1** | Daygainer 정의 (75%+, $50만 거래대금) | - | ✅ 완료 |
| **R-2** | 역대 Daygainer 라벨링 | R-1 | ✅ 완료 (1,284건) |
| **R-3** | 대조군 매칭 로직 (LLM+Massive) | R-2 | 🔲 TBD |
| **R-4** | D-1 시점 지표 계산 파이프라인 | 플랫폼 indicators | 2 |
| **R-5** | 탐색 (EDA) — 가설-검증 루프 | R-3, R-4 | 3 |
| **R-6** | 분류 모델 학습 | R-5 | 2 |
| **R-7** | SHAP + LLM 해석 파이프라인 | R-6 | 1 |
| **R-8** | 백테스트 검증 | 플랫폼 완성 | 2 |
| **총** | | | **13.5일** |

---

## 8. 성과 측정 지표

| 지표 | 정의 | 목표 |
|------|------|------|
| Precision@20 | 상위 20개 중 실제 급등 비율 | > 30% |
| Recall | 전체 급등주 중 탐지 비율 | > 50% |
| Lead Time | 급등 전 탐지 시점 | D-1 이상 |

---

## 9. 미해결 이슈

| 이슈 | 상태 |
|------|------|
| Daygainer 정의 | ✅ 확정 (75%+, 연속 가중치) |
| 대조군 매칭 상세 로직 | 🔲 TBD |
| LLM 가설-ML 검증 자동화 가능성 | 🔲 연구 필요 |
| 비정형 데이터(뉴스) 피처화 | 🔲 TBD |
| LLM API 예산 | 🔲 TBD |

---

## 10. 참조

- 상위 문서: [001-01.md](./001-01.md) — 백테스트 모듈 구축 계획서
- 토론 문서: [_detection_debate02.md](./_detection_debate02.md) — 방법론 토론

---

**문서 이력**
| 버전 | 일자 | 변경 내용 |
|------|------|----------|
| 1.0 | 2026-01-15 | 001-01.md에서 분리 |
| 2.0 | 2026-01-15 | debate02 결론 반영, 계획서 초안 형태로 재작성 |
| 2.1 | 2026-01-15 | Daygainer 정의 확정 (75%+, 연속 가중치) |
