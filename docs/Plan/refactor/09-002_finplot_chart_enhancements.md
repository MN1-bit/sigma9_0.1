# Intraday ë¦¬ìƒ˜í”Œë§ ì¸í”„ë¼ êµ¬ì¶•

> **ìƒíƒœ**: ğŸ“‹ **êµ¬í˜„ ê³„íš** (USER ìŠ¹ì¸ ëŒ€ê¸°)
> **ì‘ì„±ì¼**: 2026-01-10
> **ì˜ˆìƒ ì‘ì—… ì‹œê°„**: 6h
> **ë ˆì´ì–´**: Backend (`backend.data`) + Frontend (`frontend.gui`)

---

## 1. ëª©í‘œ

1. **On-demand ë¦¬ìƒ˜í”Œë§**: ìš”ì²­ ì‹œì—ë§Œ 3m/5m/15m/4h/1W ìƒì„± + Parquet ì €ì¥
2. **GUI ìˆ˜ë™ ì¼ê´„ ë¦¬ìƒ˜í”Œ**: Settingsì—ì„œ ì „ì²´ í‹°ì»¤ ì¼ê´„ ë¦¬ìƒ˜í”Œ (Progress + Pause/Resume)
3. **Gap-Fill ë©”ì»¤ë‹ˆì¦˜**: ëˆ„ë½ ë°ì´í„° ìë™ ê°ì§€ ë° ë³´ì¶©
4. **ì°¨íŠ¸ ìŠ¤í¬ë¡¤ ë™ì  ë¡œë”©**: viewport ë³€ê²½ ì‹œ ì¶”ê°€ ë°ì´í„° ë¡œë“œ
5. **ì—ëŸ¬ ë¡œê¹…**: ë¦¬ìƒ˜í”Œë§ ì‹¤íŒ¨/ëˆ„ë½ ì‹œ ë¡œê·¸ ì¶œë ¥

### 1.1 ì„¤ê³„ ê²°ì •: On-demand + ìºì‹±

> **í•µì‹¬**: ìš”ì²­ ì‹œ ë¦¬ìƒ˜í”Œ â†’ ì €ì¥ â†’ ì´í›„ ì§ì ‘ ë¡œë“œ. GUIì—ì„œ ìˆ˜ë™ ì¼ê´„ ì²˜ë¦¬ ì˜µì…˜ ì œê³µ.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    On-demand íë¦„                       â”‚
â”‚  Chart/Backend â†’ 5m ìš”ì²­ â†’ ì—†ìœ¼ë©´ ë¦¬ìƒ˜í”Œ + ì €ì¥        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            GUI ìˆ˜ë™ ì¼ê´„ ë¦¬ìƒ˜í”Œ (Settings)              â”‚
â”‚  [â–¶ Start] [â¸ Pause] [â¹ Stop]                          â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 60% (12,000/20,000)              â”‚
â”‚  â–¡ ì‹¤ì‹œê°„ ì „ì—­ ë¦¬ìƒ˜í”Œ (ìƒˆ ë°ì´í„° ìˆ˜ì§‘ ì‹œ ìë™ ë¦¬ìƒ˜í”Œ)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 GUI ë¦¬ìƒ˜í”Œ ê¸°ëŠ¥ ëª…ì„¸

| ì»´í¬ë„ŒíŠ¸ | ê¸°ëŠ¥ |
|----------|------|
| **Start ë²„íŠ¼** | ì „ì²´ í‹°ì»¤ ì¼ê´„ ë¦¬ìƒ˜í”Œ ì‹œì‘ |
| **Pause ë²„íŠ¼** | ì¼ì‹œ ì •ì§€ (í˜„ì¬ ì§„í–‰ ìƒíƒœ ìœ ì§€) |
| **Stop ë²„íŠ¼** | ì™„ì „ ì¤‘ë‹¨ + ì§„í–‰ ìƒíƒœ ì´ˆê¸°í™” |
| **Resume** | Pause í›„ ì´ì–´ì„œ ì§„í–‰ |
| **Progress Bar** | í˜„ì¬/ì „ì²´ í‹°ì»¤ ìˆ˜, í¼ì„¼í‹°ì§€ í‘œì‹œ |
| **ì‹¤ì‹œê°„ ì „ì—­ ë¦¬ìƒ˜í”Œ ì²´í¬ë°•ìŠ¤** | í™œì„±í™” ì‹œ: ìƒˆ 1m/1h ë°ì´í„° ìˆ˜ì§‘ ì‹œ **ëª¨ë“  í‹°ì»¤** ìë™ ë¦¬ìƒ˜í”Œ |
| **ìµœëŒ€ ì´ë ¥ ì„¤ì •** | ë¦¬ìƒ˜í”Œ ëŒ€ìƒ ê¸°ê°„ ì„¤ì • |

#### ì¼ê´„ ì²˜ë¦¬ ìˆœì„œ

> **ìˆœì„œ**: ìµœì‹  ë°ì´í„° ë¨¼ì € â†’ ê³¼ê±°ë¡œ ì§„í–‰ (ì‚¬ìš©ìê°€ ìµœì‹  ë°ì´í„°ë¥¼ ë¹¨ë¦¬ ë³¼ ìˆ˜ ìˆë„ë¡)

```
ì²˜ë¦¬ ìˆœì„œ: í˜„ì¬ â† 1ì£¼ì¼ ì „ â† 1ê°œì›” ì „ â† ... â† ì„¤ì •ê°’ê¹Œì§€
```

#### ìµœëŒ€ ì´ë ¥ UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë¦¬ìƒ˜í”Œ ìµœëŒ€ ì´ë ¥: [ 2 â–¼] [Weeks â–¼] â”‚
â”‚                    â†‘       â†‘      â”‚
â”‚              ìˆ«ì ì…ë ¥   ë‹¨ìœ„ ì„ íƒ  â”‚
â”‚              (í…ìŠ¤íŠ¸ ì§ì ‘ ì…ë ¥ ê°€ëŠ¥)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ì»´í¬ë„ŒíŠ¸ | íƒ€ì… | ì˜µì…˜ |
|----------|------|------|
| **ìˆ«ì** | QComboBox (editable) | 1, 2, 3, 7, 14, 30... (ì§ì ‘ ì…ë ¥ ê°€ëŠ¥) |
| **ë‹¨ìœ„** | QComboBox | **Hours, Days, Weeks** |

| ì˜ˆì‹œ ì„¤ì • | ì˜ë¯¸ |
|----------|------|
| `2 Weeks` | 2ì£¼ ì´ë‚´ ë°ì´í„°ë§Œ ë¦¬ìƒ˜í”Œ |
| `14 Days` | 14ì¼ ì´ë‚´ ë°ì´í„°ë§Œ ë¦¬ìƒ˜í”Œ |
| `48 Hours` | 48ì‹œê°„ ì´ë‚´ ë°ì´í„°ë§Œ ë¦¬ìƒ˜í”Œ |

### 1.3 ì‹¤ì‹œê°„ ì°¨íŠ¸ ë¦¬ìƒ˜í”Œ ì—…ë°ì´íŠ¸

> **í•µì‹¬**: íŒŒìƒ íƒ€ì„í”„ë ˆì„(5m, 15m ë“±) ì°¨íŠ¸ í‘œì‹œ ì¤‘ì—ë„ **ìµœì‹  ë´‰ì´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸**.

#### ëª¨ë“œ êµ¬ë¶„

| ëª¨ë“œ | ëŒ€ìƒ | íŠ¸ë¦¬ê±° | ìš©ë„ |
|------|------|--------|------|
| **On-demand (ê¸°ë³¸)** | í˜„ì¬ **ì°¨íŠ¸ì— í‘œì‹œ ì¤‘ì¸ í‹°ì»¤**ë§Œ | 1ì´ˆ QTimer | ì‹¤ì‹œê°„ ì¶œë ì´ëŠ” íŒŒìƒë´„ |
| **ìˆ˜ë™ ì¼ê´„** | **ëª¨ë“  í‹°ì»¤** (Start ë²„íŠ¼ í´ë¦­ ì‹œ) | Settings íŒ¨ë„ì—ì„œ ìˆ˜ë™ ì‹¤í–‰ | Parquet ì „ì²˜ë¦¬ |

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           On-demand ì‹¤ì‹œê°„ (ê¸°ë³¸, ì°¨íŠ¸ í‘œì‹œ ì¤‘)         â”‚
â”‚                                                        â”‚
â”‚  AAPL 3m ì°¨íŠ¸ í‘œì‹œ ì¤‘                                      â”‚
â”‚  AM.AAPL (1ë¶„ë´„) ìˆ˜ì‹  â†’ 1ì´ˆë§ˆë‹¤ 3më´„ ë¦¬ìƒ˜í”Œ â†’ ì°¨íŠ¸ ê°±ì‹  â”‚
â”‚  (ë‹¤ë¥¸ í‹°ì»¤ëŠ” ë¦¬ìƒ˜í”Œ ì•ˆ í•¨)                             â”‚
â”‚  â†’ "ì¶œë ì´ëŠ” 3ë¶„ë´„" íš¨ê³¼                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ìˆ˜ë™ ì¼ê´„ ë¦¬ìƒ˜í”Œ (Settings íŒ¨ë„)              â”‚
â”‚                                                        â”‚
â”‚  [â–¶ Start] ë²„íŠ¼ í´ë¦­ ì‹œ                                  â”‚
â”‚    â†’ ëª¨ë“  í‹°ì»¤ì˜ íŒŒìƒ TF (3m/5m/15m) Parquet ìƒì„±       â”‚
â”‚    â†’ Progress Barë¡œ ì§„í–‰ ìƒíƒ€ í‘œì‹œ                        â”‚
â”‚    â†’ Pause/Stop/Resume ì œì–´ ê°€ëŠ¥                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì „ì—­ ê°±ì‹  ì‹œ ì¸í¬ë¦¬ë©˜íƒˆ ì—…ë°ì´íŠ¸

> **í•µì‹¬**: ê¸°ì¡´ Parquetì˜ **ì‹œì‘/ë ì‹œê°„ ì²´í¬** â†’ í•„ìš”í•œ ë²”ìœ„ë§Œ ë¦¬ìƒ˜í”Œ (ì „ì²´ ì¬ì²˜ë¦¬ X)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ê¸°ì¡´ 5m Parquet: 10:00 ~ 10:25                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Case 1: ìƒˆ 1m = 10:27  â†’ ë append (10:25 ë´‰ ì—…ë°ì´íŠ¸)  â”‚
â”‚  Case 2: ìƒˆ 1m = 09:55  â†’ ì• prepend (09:55 ë´‰ ì¶”ê°€)    â”‚
â”‚  Case 3: ì¤‘ê°„ ê°­        â†’ ê°­ ë²”ìœ„ë§Œ ë¦¬ìƒ˜í”Œ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ì²´í¬ | ë™ì‘ |
|------|------|
| `new_time < existing_start` | ì•ìª½ ê°­ â†’ prepend |
| `new_time > existing_end` | ë’¤ìª½ ê°­ â†’ append/update last bar |
| `existing_start <= new_time <= existing_end` | í•´ë‹¹ ë´‰ë§Œ ì—…ë°ì´íŠ¸ |

| ì„¤ì • | On-demand | ìˆ˜ë™ ì¼ê´„ |
|------|-----------|------|
| ì—…ë°ì´íŠ¸ ì£¼ê¸° | **1ì´ˆ** (QTimer) | ìˆœì°¨ ì²˜ë¦¬ |
| ëŒ€ìƒ | í˜„ì¬ ì°¨íŠ¸ í‹°ì»¤ | ëª¨ë“  í‹°ì»¤ |
| ë¦¬ìƒ˜í”Œ ì†ŒìŠ¤ | ë©”ëª¨ë¦¬ ë²„í¼ | Parquet íŒŒì¼ |
| Parquet ì €ì¥ | âŒ (í‘œì‹œìš©) | âœ… (ì˜êµ¬ ì €ì¥) |
| íŠ¸ë¦¬ê±° | AM.{ticker} | Start ë²„íŠ¼ |
| ì§„í–‰ ì œì–´ | N/A | Pause/Stop/Resume |

| íŠ¹ì„± | ê°’ |
|------|---|
| ì²« ìš”ì²­ | ë¦¬ìƒ˜í”Œ ë°œìƒ (~50ms) |
| ì´í›„ ìš”ì²­ | Parquet ì§ì ‘ ë¡œë“œ (~10ms) |
| ì €ì¥ ìœ„ì¹˜ | `data/parquet/intraday/{tf}/{ticker}.parquet` |

---

## 2. ë ˆì´ì–´ ì²´í¬ (REFACTORING.md Â§2-Â§3)

- [x] **ë ˆì´ì–´ ê·œì¹™ ìœ„ë°˜ ì—†ìŒ**
  - `ParquetManager` â†’ `backend.data` (í•˜ìœ„ ë ˆì´ì–´)
  - `ChartDataService` â†’ `frontend.services` (Frontend ë‚´ë¶€)
  - Backend â†” Frontend ì§ì ‘ import ì—†ìŒ âœ…
- [x] **ìˆœí™˜ ì˜ì¡´ì„± ì—†ìŒ** - ì‹ ê·œ ì½”ë“œ, ê¸°ì¡´ ëª¨ë“ˆê³¼ ì˜ì¡´ê´€ê³„ ë‹¨ë°©í–¥
- [x] **DI Container ë“±ë¡ í•„ìš”**: **ì•„ë‹ˆì˜¤**
  - `ParquetManager`ëŠ” ì´ë¯¸ Container ë“±ë¡ë¨ (11-001)
  - GUI íŒ¨ë„ì€ DI ë¶ˆí•„ìš” (Frontend)
- [x] **í¬ê¸° ì œí•œ ì²´í¬ (Â§8)**
  - `parquet_manager.py` í˜„ì¬ ~200ì¤„ + 80ì¤„ = ~280ì¤„ âœ… (< 500ì¤„)
  - `resample_panel.py` ì‹ ê·œ ~150ì¤„ âœ…
  - `finplot_chart.py` í˜„ì¬ ~450ì¤„ + 60ì¤„ = ~510ì¤„ âš ï¸ â†’ í•„ìš”ì‹œ ë¶„í•  ê²€í† 

---

## 3. ê¸°ì¡´ ì†”ë£¨ì…˜ ê²€ìƒ‰ ê²°ê³¼ (REFACTORING.md Â§5)

| ì†”ë£¨ì…˜ | ì¶œì²˜ | ì±„íƒ ì—¬ë¶€ | ì‚¬ìœ  |
|--------|------|----------|------|
| `pandas.DataFrame.resample()` | pandas | âœ… ì±„íƒ | í‘œì¤€ OHLCV ë¦¬ìƒ˜í”Œë§ í•¨ìˆ˜ |
| `finplot` viewport ì½œë°± | pyqtgraph | âœ… ì±„íƒ | `sigXRangeChanged` ì‹œê·¸ë„ ì¬ì‚¬ìš© |
| third-party ë¦¬ìƒ˜í”Œë§ ë¼ì´ë¸ŒëŸ¬ë¦¬ | PyPI | âŒ ë¯¸ì±„íƒ | pandas ë‚´ì¥ ê¸°ëŠ¥ìœ¼ë¡œ ì¶©ë¶„ |

> âœ… ê²€ìƒ‰ ì™„ë£Œ: pandas ë‚´ì¥ `resample()` ì‚¬ìš©, ë³„ë„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆí•„ìš”

---

## 4. ì•„í‚¤í…ì²˜

### 4.1 ë””ë ‰í„°ë¦¬ êµ¬ì¡° (ê¸°ì¡´ parquet_manager.py íŒ¨í„´ ìœ ì§€)

> **NOTE**: ê¸°ì¡´ `{ticker}_{timeframe}.parquet` íŒ¨í„´ ìœ ì§€ (ë§ˆì´ê·¸ë ˆì´ì…˜ ë¶ˆí•„ìš”)

```
data/parquet/intraday/          # â† ê¸°ì¡´ êµ¬ì¡° ìœ ì§€
â”œâ”€â”€ AAPL_1m.parquet             # API ì›ë³¸ (ìˆ˜ì§‘ ìŠ¤í¬ë¦½íŠ¸)
â”œâ”€â”€ AAPL_1h.parquet             # API ì›ë³¸ (ìˆ˜ì§‘ ìŠ¤í¬ë¦½íŠ¸)
â”œâ”€â”€ AAPL_3m.parquet             # ë¦¬ìƒ˜í”Œë§ ìƒì„±
â”œâ”€â”€ AAPL_5m.parquet             # ë¦¬ìƒ˜í”Œë§ ìƒì„±
â”œâ”€â”€ AAPL_15m.parquet            # ë¦¬ìƒ˜í”Œë§ ìƒì„±
â”œâ”€â”€ AAPL_4h.parquet             # ë¦¬ìƒ˜í”Œë§ ìƒì„±
â””â”€â”€ AAPL_1W.parquet             # ë¦¬ìƒ˜í”Œë§ ìƒì„±
```

### 4.2 ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ParquetManager                             â”‚
â”‚  get_intraday_bars(ticker, tf, auto_fill=True)                  â”‚
â”‚  save_intraday_bars(ticker, tf, df)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              IntradayResampler (ìŠ¤í¬ë¦½íŠ¸ ì „ìš©)                   â”‚
â”‚  resample_ticker(ticker, target_tf, log_missing=True)          â”‚
â”‚  resample_all(target_tf)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ChartDataService                            â”‚
â”‚  get_chart_data(ticker, tf)                                    â”‚
â”‚    â†’ ParquetManager.get_intraday_bars() í˜¸ì¶œ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FinplotChartWidget                           â”‚
â”‚  ax.vb.sigXRangeChanged â†’ _on_viewport_changed                 â”‚
â”‚    â†’ viewport_data_needed emit (150ms debounce)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Gap-Fill ë©”ì»¤ë‹ˆì¦˜

### 5.1 Backend Gap-Fill (ë°ì´í„° ìš”ì²­ ì‹œ)

#### ë¦¬ìƒ˜í”Œë§ ì†ŒìŠ¤ ê·œì¹™

| Target TF | Source TF | pandas rule | ì„¤ëª… |
|-----------|-----------|-------------|------|
| 3m  | **1m** | `3T` | 1ë¶„ë´‰ 3ê°œ ì§‘ê³„ |
| 5m  | **1m** | `5T` | 1ë¶„ë´‰ 5ê°œ ì§‘ê³„ |
| 15m | **1m** | `15T` | 1ë¶„ë´‰ 15ê°œ ì§‘ê³„ |
| 4h  | **1h** | `4H` | 1ì‹œê°„ë´‰ 4ê°œ ì§‘ê³„ |
| 1W  | **1D** | `W-FRI` | ì¼ë´‰ 5ê°œ ì§‘ê³„ (ê¸ˆìš”ì¼ ê¸°ì¤€) |

```python
# ParquetManager
RESAMPLE_RULES = {
    "3m": ("1m", "3T"),
    "5m": ("1m", "5T"),
    "15m": ("1m", "15T"),
    "4h": ("1h", "4H"),   # â† 1Hì—ì„œ íŒŒìƒ
    "1W": ("1D", "W-FRI"),  # â† 1Dì—ì„œ íŒŒìƒ
}

def get_intraday_bars(self, ticker: str, tf: str, auto_fill: bool = True):
    path = self.intraday_dir / tf / f"{ticker}.parquet"
    
    if not path.exists():
        if auto_fill:
            logger.warning(f"[GAP-FILL] {ticker}/{tf} íŒŒì¼ ì—†ìŒ, ë¦¬ìƒ˜í”Œë§ ì‹œë„")
            return self._try_resample(ticker, tf)
        return pd.DataFrame()
    
    return pd.read_parquet(path)

def _try_resample(self, ticker: str, tf: str) -> pd.DataFrame:
    source_tf, rule = RESAMPLE_RULES.get(tf, (None, None))
    if not source_tf:
        logger.error(f"[GAP-FILL] {tf}ì— ëŒ€í•œ ë¦¬ìƒ˜í”Œ ê·œì¹™ ì—†ìŒ")
        return pd.DataFrame()
    
    source_df = self.get_intraday_bars(ticker, source_tf, auto_fill=False)
    if source_df.empty:
        logger.error(f"[GAP-FILL] {ticker}/{source_tf} ì†ŒìŠ¤ ë°ì´í„° ì—†ìŒ")
        return pd.DataFrame()
    
    resampled = self._resample_df(source_df, rule)
    self.save_intraday_bars(ticker, tf, resampled)
    return resampled
```

### 5.2 ì°¨íŠ¸ ìŠ¤í¬ë¡¤ ì‹œ ë™ì  ë¡œë”©

```python
# FinplotChartWidget
def _setup_viewport_handler(self):
    self._viewport_timer = QTimer()
    self._viewport_timer.setSingleShot(True)
    self._viewport_timer.setInterval(150)  # 150ms ë””ë°”ìš´ìŠ¤
    self._viewport_timer.timeout.connect(self._check_viewport_data_needs)
    
    # finplot axì˜ ViewBoxì—ì„œ ì‹œê·¸ë„ ì—°ê²°
    self.ax.vb.sigXRangeChanged.connect(self._on_viewport_changed)
```

---

## 6. ë¡œê¹… ì„¤ê³„

| ìƒí™© | ë ˆë²¨ | ë©”ì‹œì§€ ì˜ˆì‹œ |
|------|------|------------|
| ë¦¬ìƒ˜í”Œë§ ì‹œì‘ | INFO | `[RESAMPLE] AAPL 1mâ†’5m ì‹œì‘` |
| ë¦¬ìƒ˜í”Œë§ ì„±ê³µ | INFO | `[RESAMPLE] AAPL 5m ì €ì¥ (500 bars)` |
| ì†ŒìŠ¤ íŒŒì¼ ì—†ìŒ | WARNING | `[GAP-FILL] AAPL/1m ì†ŒìŠ¤ ì—†ìŒ` |
| ì €ì¥ ì‹¤íŒ¨ | ERROR | `[RESAMPLE] AAPL/5m ì €ì¥ ì‹¤íŒ¨: {exception}` |

**ì¼ê´„ ì‹¤í–‰ ë¦¬í¬íŠ¸**: `logs/resample_failures.log` ì €ì¥

---

## 7. ë³€ê²½ íŒŒì¼

| íŒŒì¼ | ìœ í˜• | ì˜ˆìƒ ë¼ì¸ | ì„¤ëª… |
|------|-----|----------|------|
| `backend/data/parquet_manager.py` | MODIFY | +80 | `get_intraday_bars(tf)`, `_try_resample()`, `resample_all_tickers()` |
| `frontend/gui/chart/finplot_chart.py` | MODIFY | +60 | viewport ì‹œê·¸ë„ + ì‹¤ì‹œê°„ ë´‰ ì—…ë°ì´íŠ¸ |
| `frontend/gui/panels/resample_panel.py` | **NEW** | ~150 | ë¦¬ìƒ˜í”Œ ì»¨íŠ¸ë¡¤ íŒ¨ë„ (Progress, Pause/Resume/Stop) |
| `frontend/services/chart_data_service.py` | MODIFY | +30 | gap-fill + ì‹¤ì‹œê°„ ë¦¬ìƒ˜í”Œ |

---

## 8. ì‹¤í–‰ ë‹¨ê³„

### Step 1: ParquetManager í™•ì¥ (1.5h)
- `get_intraday_bars(ticker, tf, auto_fill=True)`
- `_try_resample()`, `_resample_df()` ë‚´ë¶€ ë©”ì„œë“œ
- ë¡œê¹… (`loguru`)

```python
# ì¼ê´„ ì²˜ë¦¬ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜
def resample_all_tickers(
    self,
    target_tf: str,
    callback: Callable[[str, int, int], None],  # (ticker, current, total)
    max_history: timedelta = timedelta(weeks=2),
) -> int:
    """ëª¨ë“  í‹°ì»¤ì— ëŒ€í•´ target_tf ë¦¬ìƒ˜í”Œë§ ìˆ˜í–‰, ì§„í–‰ìƒí™© ì½œë°± í˜¸ì¶œ"""
```

### Step 2: ResamplePanel GUI êµ¬í˜„ (2h)
- Start/Pause/Stop/Resume ë²„íŠ¼
- QProgressBar (í˜„ì¬/ì „ì²´ + %)
- "ì‹¤ì‹œê°„ ì „ì—­ ë¦¬ìƒ˜í”Œ" ì²´í¬ë°•ìŠ¤
- Worker ìŠ¤ë ˆë“œ (QThread) + ì‹œê·¸ë„ë¡œ ì§„í–‰ ìƒíƒœ ì „ë‹¬

### Step 3: ì‹¤ì‹œê°„ ì°¨íŠ¸ ë¦¬ìƒ˜í”Œ ì—…ë°ì´íŠ¸ (1.5h)
- AM.* WebSocket 1ë¶„ë´‰ ìˆ˜ì‹  ì‹œ â†’ ë©”ëª¨ë¦¬ ë²„í¼ì— ëˆ„ì 
- 1ì´ˆ QTimerë¡œ í˜„ì¬ íŒŒìƒ ë´‰ ê³„ì‚° (5m = ìµœê·¼ 1~5ë¶„ ë°ì´í„°)
- `FinplotChartWidget._update_latest_candle()` - ë§ˆì§€ë§‰ ë´‰ë§Œ ì—…ë°ì´íŠ¸
- ì „ì²´ ì°¨íŠ¸ ë¦¬ë¡œë“œ ì—†ì´ **ì¸í¬ë¦¬ë©˜íƒˆ** ì—…ë°ì´íŠ¸

### Step 4: FinplotChartWidget viewport ì—°ê²° (0.5h)
- `sigXRangeChanged` ì—°ê²°
- `viewport_data_needed` emit

```python
# finplot_chart.py ì°¸ì¡° (í˜„ì¬ êµ¬ì¡°):
self.ax = fplt.create_plot(init_zoom_periods=100)
self.ax.vb.sigXRangeChanged.connect(self._on_viewport_changed)  # â† ì´ ì‹œê·¸ë„ ì‚¬ìš©
```

### Step 5: ê²€ì¦ + ë¬¸ì„œí™” (0.5h)

---

## 9. ê²€ì¦ ê³„íš

### 9.1 ë¦°íŠ¸ ê²€ì¦ (í•„ìˆ˜)

```powershell
# import-linter (REFACTORING.md Â§5)
lint-imports

# ruff
ruff check backend/data/parquet_manager.py

# pydeps ìˆœí™˜ ì²´í¬ (ì‹ ê·œ ëª¨ë“ˆ ì¶”ê°€ ì‹œ)
pydeps backend.data --only backend --show-cycles --no-output
```

### 9.2 On-demand ë¦¬ìƒ˜í”Œë§ ê²€ì¦

```python
# 5m íŒŒì¼ì´ ì—†ëŠ” ìƒíƒœì—ì„œ ìš”ì²­ â†’ ìë™ ìƒì„± í™•ì¸
from backend.data.parquet_manager import ParquetManager
pm = ParquetManager()
df = pm.get_intraday_bars("AAPL", "5m", auto_fill=True)

assert not df.empty  # 1mì—ì„œ ë¦¬ìƒ˜í”Œë˜ì–´ ë°˜í™˜
assert (pm.intraday_dir / "5m" / "AAPL.parquet").exists()  # ì €ì¥ í™•ì¸
```

### 9.3 Gap-Fill ê²€ì¦

```python
# auto_fill í…ŒìŠ¤íŠ¸
from backend.data.parquet_manager import ParquetManager
pm = ParquetManager()
df = pm.get_intraday_bars("AAPL", "5m", auto_fill=True)
assert not df.empty
```

### 9.4 ì°¨íŠ¸ ìŠ¤í¬ë¡¤ ê²€ì¦ (ìˆ˜ë™)

1. ëŒ€ì‹œë³´ë“œ ì‹¤í–‰: `python -m frontend.main`
2. A~M ì¢…ëª© ì„ íƒ (AAPL ì¶”ì²œ) â†’ 5m í´ë¦­
3. ì°¨íŠ¸ ì™¼ìª½ìœ¼ë¡œ ìŠ¤í¬ë¡¤ â†’ ë¡œê·¸ì— `[INFO] ğŸ“Š Loading more data` í™•ì¸

---

## 10. ë‹¤ìŒ ë‹¨ê³„

- [ ] ì‚¬ìš©ì ìŠ¹ì¸
- [ ] `/IMP-execution`
- [ ] â†’ **09-003** (íƒ€ì„í”„ë ˆì„ ë²„íŠ¼ + í…Œë§ˆ GUI) ì§„í–‰
